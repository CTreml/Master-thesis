###Sankey diagram for categorical variables
###Scatter plots, weighted scatter plots, Pearson correlation coefficient for continuously distributed variables
###linear regression models / multinomial logit model 


finlitselfemployed <- glm(finlit ~ selfemployedd , data=ASFL7, weights=ASFL7$wght)
summary(finlitselfemployed)
residfinlitselfemployed <- finknowselfemployed$residuals
xtable(finlitselfemployed, type = "latex", file = "finknowselfemployed", digits=3)
#test for normal distribution
plot(residfinlitselfemployed)
qqnorm(residfinlitselfemployed) 
qqline(residfinlitselfemployed, col="blue")#homoskedasticity is given 
shapiro.test(residfinlitselfemployed) #W < critical value W (from table - depending on sample size and significance level)  => not normally distributed/H0 refused
ks.test(residfinlitselfemployed, 'pnorm')
#shapiro.test or Koglmogorov-Smirnov test => p>0.05 ... normally distributed
#in case of heteroskedasticity 
coeftest(finlitselfemployed, vcov = vcovHC(finlitselfemployed, type = "HC0")) #"HC" (or equivalently "HC0") gives White's estimator


#for individual indicators
finlitemployed <- glm(finlit ~ employedd , data=ASFL7, weights=ASFL7$wght)
summary(finlitemployed)
finknowselfemployed <- glm(fin_know ~ selfemployedd , data=ASFL7, weights=ASFL7$wght)
summary(finknowselfemployed)
finknowemployed <- glm(fin_know ~ employedd , data=ASFL7, weights=ASFL7$wght)
summary(finknowemployed)
finknowselfemployed2 <- glm(fin_know ~ selfemployedd + employedd , data=ASFL7, weights=ASFL7$wght)
summary(finknowselfemployed2)
finattselfemployed <- glm(fin_att ~ selfemployedd , data=ASFL7, weights=ASFL7$wght)
summary(finattselfemployed)
finattemployed <- glm(fin_att ~ employedd , data=ASFL7, weights=ASFL7$wght)
summary(finattemployed)
finattselfemployed2 <- glm(fin_att ~ selfemployedd + employedd , data=ASFL7, weights=ASFL7$wght)
summary(finattselfemployed2)
finbehselfemployed <- glm(fin_beh ~ selfemployedd , data=ASFL7, weights=ASFL7$wght)
summary(finbehselfemployed)
finbehemployed <- glm(fin_beh ~ employedd , data=ASFL7, weights=ASFL7$wght)
summary(finbehemployed)
finbehselfemployed2 <- glm(fin_beh ~ selfemployedd +employedd, data=ASFL7, weights=ASFL7$wght)
summary(finbehselfemployed2)

####additional control variables
finlitage <- glm(finlit ~age , data=ASFL7, weights=ASFL7$wght)
summary(finlitage)
w.plot(ASFL7$age, ASFL7$finlit, 0.2, ASFL7$wght, lwd=1)
ggplot(ASFL7, aes(x = age, y = finlit)) +
  geom_point() +
  geom_smooth(method = "glm", se = FALSE) +
  labs(x = "age", y = "finlit")

finlitagese <- glm(finlit ~age , data=ASFL7se, weights=ASFL7se$wght)
summary(finlitagese)

finlitage2 <- glm(finlit ~age + age2 , data=ASFL7, weights=ASFL7$wght)
finlitage3 <- glm(finlit ~rootage , data=ASFL7, weights=ASFL7$wght)
finlitage4 <- glm(finlit ~age + age*finlit , data=ASFL7, weights=ASFL7$wght)
summary(finlitage3)
finlitselfagesimple <- glm(finlit ~ selfemployedd + age , data=ASFL7, weights=ASFL7$wght)
summary(finlitselfagesimple)

xtable(finlitselfemploymentfull1, type = "latex", file = "finlitselfemploymentfull1", digits=3)

finlitselfagesimplequ <- lm(finlit ~ selfemployedd + age + age2, data=ASFL7, weights=ASFL7$wght)
summary(finlitselfagesimplequ)
finknowselfemployed4 <- lm(finlit ~ selfemployedd + rootage, data=ASFL7, weights=ASFL7$wght)
summary(finknowselfemployed4)
finknowselfemployed4 <- lm(finlit ~ selfemployedd + age + age*finlit, data=ASFL7, weights=ASFL7$wght)
summary(finknowselfemployed4)



#taking risk into account
#risk individually
finlitrisk <- glm(finlit ~ HFCSriskd,  data=ASFL7, weights=ASFL7$wght)
summary(finlitrisk)
finlitrisk2 <- glm(finlit ~ HFCSriskad,data=ASFL7, weights=ASFL7$wght) #reasonable to include dummy, where only "no" indications are counted as no
summary(finlitrisk2)  
finlitrisk2se <- glm(finlit ~ HFCSriskad,data=ASFL7se, weights=ASFL7se$wght) #reasonable to include dummy, where only "no" indications are counted as no
summary(finlitrisk2se)  
finlitrisk2e <- glm(finlit ~ HFCSriskad,data=ASFL7e, weights=ASFL7e$wght) #reasonable to include dummy, where only "no" indications are counted as no
summary(finlitrisk2e)  
finknowrisk <- glm(fin_know ~ HFCSriskd,data=ASFL7e, weights=ASFL7e$wght)
summary(finknowrisk)
finknowrisk2 <- glm(fin_know ~ HFCSriskad,data=ASFL7, weights=ASFL7$wght) #reasonable to include dummy, where only "no" indications are counted as no
summary(finknowrisk2)  
finknowrisk2 <- glm(fin_know ~ HFCSriskad,data=ASFL7se, weights=ASFL7se$wght)
summary(finknowrisk2)
finknowrisk2 <- glm(fin_know ~ HFCSriskad,data=ASFL7e, weights=ASFL7e$wght)
summary(finknowrisk2)  
finknowrisk2 <- glm(fin_know ~ HFCSriskad,data=ASFL7oth, weights=ASFL7oth$wght) #only highly significant for those not actively employed
summary(finknowrisk2)  
selfemployedrisk <- glm(selfemployedd ~ HFCSriskd,data=ASFL7, weights=ASFL7$wght)
summary(selfemployedrisk)
selfemployedrisk2 <- glm(selfemployedd ~ HFCSriskad,data=ASFL7, weights=ASFL7$wght)
summary(selfemployedrisk2) 



#always exclude one group - otherwise: perfect collinearity (zB:maled + femaled = 1)-> error would not occur for variables with missings but exclude one! 
finlitselfemploymentfull1 <- glm(finlit ~ selfemployedd + age + femaled + unieduc  + townd+cityd + childd + singled +hincomemiddled+hincomehighd , data=ASFL7, weights=ASFL7$wght)
summary(finlitselfemploymentfull1)
finlitselfemploymentfull2 <- glm(finlit ~ selfemployedd + age + femaled + unieduc  + townd+cityd + childd + singled +hincomemiddled+hincomehighd + riskyassetsd + HFCSriskad, data=ASFL7, weights=ASFL7$wght)
summary(finlitselfemploymentfull2)
finlitselfemploymentfull3 <- glm(fin_know ~ selfemployedd + age + femaled + unieduc +hincomemiddled+hincomehighd + riskyassetsd , data=ASFL7, weights=ASFL7$wght)
summary(finlitselfemploymentfull3)



##F-test - The larger the F value, the more likely it is that the variation caused by the independent variable is real and not due to chance.
#p-Wert kleiner als 0,05 =>  Nullhypothese ablehnen=>  genÃ¼gend Beweise , um zu sagen, dass die beiden Populationsvarianzen nicht gleich sind.
#wald.test(Sigma = vcov(model), b = coef(model), Terms = 3:4)-p> .05, we fail to reject the null hypothesis of the Wald test.=> tested regression coefficients are both equal to zero.
#wald.test(fitf,term=9)
#var.testPerforms an F test to compare the variances of two samples from normal populations.


######################ROBUSTNESS CHECKS############################################
#converserelation
selfemployedfinlit <- glm(selfemployedd ~ finlit , data=ASFL7, family=binomial(logit), weights=ASFL7$wght)
summary(selfemployedfinlit)
#for employed
finknowemployed <- glm(finlit ~ employedd , data=ASFL7, weights=ASFL7$wght)
summary(finknowemployed)
residfinknowemployed <- finknowemployed$residuals
xtable(finknowemployed, type = "latex", file = "finknowemployed", digits=3)
shapiro.test(residfinknowemployed)

finknowfullemploy <- glm(finlit ~ selfemployedd  + employedd + unemployedd+ retiredd +homed + studentd, data=ASFL7, weights=ASFL7$wght)
summary(finknowfullemploy)

#######################MULTINOMIAL LOGIT model########################################
logitfinknowselfemployed <- gglm(highfinlitd ~ selfemployedd , data=ASFL7, weights=ASFL7$wght, family=binomial(logit))

multinomialfinlitselfemployment <- multinom(finlit_group ~ selfemployedd , data = ASFL7, weights=ASFL7$wght)
summary(multinomialfinlitselfemployment)
se <- summary(multinomialfinlitselfemployment)$coefficients/summary(multinomialfinlitselfemployment)$standard.errors
se
p <- (1 - pnorm(abs(se), 0, 1)) * 2 #p-Wert Berechnung!!
p

