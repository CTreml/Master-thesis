.libPaths()
library(dplyr)
library(sandwich)
library(stargazer)
library(ggplot2)
library(weights)
library(xtable)
library(lmtest)
library(ggalluvial)
library(foreign)
library(reshape2)
library(nnet)
library(Weighted.Desc.Stat)
library(aod)
library(glmtoolbox)
library(pscl)
library(AICcmodavg)
library(DescTools)

#setting the working directory
setwd("C:/Users/carme/Documents/Studium/Master Economics/Master Thesis")
ASFL_org <- readstata13::read.dta13("./Questionnaire & Dataset/Data/oecd_2019_engl_final_official.dta")
ASFL_add<- readstata13::read.dta13("./Questionnaire & Dataset/Data/add_austria-specific.dta")
ASFL_full <- merge (ASFL_org, ASFL_add, by="id")
ASFL <- ASFL_full


#########################BASICS##########################################
##################################EMPLOYMENT##################################
table(ASFL$QD10)
employment1 <-ASFL$QD10 

ASFL <- ASFL %>%
  mutate(employment1=case_when(
    employment1 =="Self-employed [work for myself]"~"Self-employed",
    employment1 =="In paid employment [work for someone else]"~"Employed",
    employment1 =="Looking for work [unemployed]"~"Other",
    employment1 =="Not working and not looking for work"~"Other",
    employment1 =="Retired"~"Other",
    employment1 =="Student"~"Other",
    employment1 =="Apprentice"~"Other",
    employment1 =="Looking after the home"~"Other",
    employment1 =="Other"~"Other"))

employment1_1 <- as.factor(ASFL$employment1)
levels(employment1_1)
ASFL <- within(ASFL, employment1_1 <- relevel(employment1_1, ref = "Other"))

employment1_2 <- as.factor(ASFL$employment1)
levels(employment1_2)
ASFL <- within(ASFL, employment1_2 <- relevel(employment1_2, ref = "Employed"))

employment2 <- ASFL$QD10
ASFL <- ASFL %>%
  mutate(employment2=case_when(employment2 =="Self-employed [work for myself]"~"Self-employed",
                               employment2 =="In paid employment [work for someone else]"~"Employed",
                               TRUE ~ NA))
employment2_2 <- as.factor(ASFL$employment2)
levels(employment2_2)
ASFL <- within(ASFL, employment2_2 <- relevel(employment2_2, ref = "Employed"))#in payed employed used as the reference group

employmentfull <- ASFL$QD10
ASFL <- ASFL %>%
  mutate(employmentfull=case_when(
    employmentfull =="In paid employment [work for someone else]"~"Employed",
    employmentfull =="Self-employed [work for myself]"~"Self-employed",
    employmentfull =="Looking for work [unemployed]"~"Unemployed",
    employmentfull =="Not working and not looking for work"~"Not working",
    employmentfull =="Retired"~"Retired",
    employmentfull =="Student"~"Student",
    employmentfull =="Apprentice"~"Apprentice",
    employmentfull =="Looking after the home"~"Home",
    employmentfull =="Other"~"Other"
  ))
employmentfull_full <- as.factor(ASFL$employmentfull)
levels(employmentfull_full)
ASFL <- within(ASFL, employmentfull_full <- relevel(employmentfull_full, ref = "Employed"))

employmentalt <-ASFL$QD10 
ASFL <- ASFL %>%
  mutate(employmentalt=case_when(
    employmentalt =="In paid employment [work for someone else]"~"Employed",
    employmentalt =="Self-employed [work for myself]"~"Self-employed",
    employmentalt =="Looking for work [unemployed]"~"Unemployed",
    employmentalt =="Retired"~"Retired",
    TRUE ~ "Other"
  ))
employmentalt_alt <- as.factor(ASFL$employmentalt)
levels(employmentalt_alt)
ASFL <- within(ASFL, employmentalt_alt <- relevel(employmentalt_alt, ref = "Employed"))


selfemployedd<- ifelse(ASFL$QD10 == "Self-employed [work for myself]", 1, 0)
selfemployedd <- as.numeric(selfemployedd)

employmentunempl <-ASFL$QD10 
ASFL <- ASFL %>%
  mutate(employmentunempl=case_when(
    employmentunempl =="Self-employed [work for myself]"~"Self-employed",
    employmentunempl =="In paid employment [work for someone else]"~"Employed",
    employmentunempl =="Looking for work [unemployed]"~"Employed",
    employmentunempl =="Not working and not looking for work"~"Other",
    employmentunempl =="Retired"~"Other",
    employmentunempl =="Student"~"Other",
    employmentunempl =="Apprentice"~"Other",
    employmentunempl =="Looking after the home"~"Other",
    employmentunempl =="Other"~"Other"))

employmentunempl_1 <- as.factor(ASFL$employmentunempl)
levels(employmentunempl_1)
ASFL <- within(ASFL, employmentunempl_1 <- relevel(employmentunempl_1, ref = "Other"))

ASFL<-cbind(ASFL,employment1_1,employment2_2,employmentfull_full,employmentalt_alt, employmentunempl_1)


##alternative: QF9_11 ##own business as a retirement funding option
summary(ASFL$QF9_11)
retirefundbusinessd <- ifelse(ASFL$QF9_11 == "Yes", 1, 0)
table(retirefundbusinessd)
table(selfemployedd)

employedd<- ifelse(ASFL$QD10 == "In paid employment [work for someone else]", 1, 0) #maybe keep those looking for work?
employedd <- as.numeric(employedd)
unemployedd<- ifelse(ASFL$QD10 == "Looking for work [unemployed]", 1, 0)



ASFL$sevseempl
apprenticed<- ifelse(ASFL$QD10 == "Apprentice", 1, 0)
studentd<- ifelse(ASFL$QD10 == "Student", 1, 0)
otherd<- ifelse(ASFL$QD10 == "Other", 1, 0)
retiredd<- ifelse(ASFL$QD10 == "Retired", 1, 0)
homed <- ifelse(ASFL$QD10 == "Looking after the home", 1, 0)
notactived<-ifelse(ASFL$QD10 == "Not working and not looking for work", 1, 0)

othersd <- unemployedd+apprenticed+studentd+otherd+retiredd+homed+notactived
othersworetd <- unemployedd+apprenticed+studentd+otherd+homed+notactived
otherswounempld <- apprenticed+studentd+otherd+retiredd+homed+notactived
otherswounemplretd <- apprenticed+studentd+otherd+homed+notactived

se <- c("Self-employed [work for myself]")
e <- c("In paid employment [work for someone else]")
eu <- c("In paid employment [work for someone else]","Looking for work [unemployed]")
empl <- c("In paid employment [work for someone else]","Self-employed [work for myself]")
unempl <- c("Looking for work [unemployed]")
oth <- c("Looking for work [unemployed]","Apprentice","Student","Other","Retired","Looking after the home", "Not working and not looking for work")
othworet <- c("Looking for work [unemployed]","Apprentice","Student","Other","Looking after the home", "Not working and not looking for work")
ret <- c("Retired")
stud <- c("Student","Apprentice")
regempl <- c("In paid employment [work for someone else]","Self-employed [work for myself]","Looking for work [unemployed]","Retired")

#QF9_11 - Retirement funding - From the revenues of a business that you own - as a possible robustness check
ASFL$QF9_11
entrepreneurs <- c("Yes")
ASFLentrepreneurs <- ASFL[(ASFL$QF9_11 %in% entrepreneurs),] 
entrepreneursd<-ifelse(ASFL$QF9_11 == "Yes", 1, 0)


ASFLse <- ASFL[(ASFL$QD10 %in% se),] 
summary(ASFLse)
ASFLe <- ASFL[(ASFL$QD10 %in% e),] 
summary(ASFLe)
ASFLeu <-  ASFL[(ASFL$QD10 %in% eu),] 
summary(ASFLeu)
ASFLunempl <-  ASFL[(ASFL$QD10 %in% unempl),] 
summary(ASFLunempl)
ASFLoth <-  ASFL[(ASFL$QD10 %in% oth),] 
summary(ASFLoth)
640+699+79
ASFLempl <- ASFL[(ASFL$QD10 %in% empl),] 
ASFLempl$QD10
ASFLregempl <- ASFL[(ASFL$QD10 %in% regempl),] 
ASFLothworet <-  ASFL[(ASFL$QD10 %in% othworet),] 
summary(ASFLothworet)
ASFLothworet <-  ASFL[(ASFL$QD10 %in% othworet),] 
summary(ASFLothworet)
ASFLstud <-  ASFL[(ASFL$QD10 %in% stud),] 
summary(ASFLstud)
ASFLret <-  ASFL[(ASFL$QD10 %in% ret),] 
summary(ASFLret)


ASFL <- cbind(ASFL,employedd,selfemployedd,entrepreneursd,othersd,othersworetd,otherswounempld,otherd,apprenticed,studentd,retiredd,notactived,homed,unemployedd)
##################################add_employment#########################
summary(ASFL$QF9_10) #still working in pension to fund retirement
summary(ASFL$st1ab) #respondent ever employed
summary(ASFL$st3ab) #person contributing most to household income ever employed

##################################AGE##################################
age<-ASFL$QD7
summary(ASFL$QD7)
age2 <- age^2
rootage <- sqrt(ASFL$QD7)
ASFL["age_group"] = cut(as.numeric(as.character(ASFL$QD7)), c(16, 28, 38, 58, 74, Inf), c("16-28", "29-38", "39-58", "59-74", ">75"), include.lowest=TRUE)
table(ASFL$age_group)
youngmilld<- ifelse(ASFL$age_group == "16-28", 1, 0)
oldmilld<- ifelse(ASFL$age_group == "29-38", 1, 0)
genxd <- ifelse(ASFL$age_group == "39-58", 1, 0)
babyboomd <- ifelse(ASFL$age_group == "59-74", 1, 0)
silgend<- ifelse(ASFL$age_group == ">75", 1, 0)

summary(ASFL$age_group)
ASFL <- cbind(ASFL,age,youngmilld,oldmilld,genxd,babyboomd,silgend,age2,rootage)

youngmill <- c("16-28")
oldmill <- c("29-38")
genx <- c("39-58")
babyboom <- c("59-74")
silgen <- c(">75")

#youngmill<- ASFL[(ASFL$age_group %in% youngmill),] 
#oldmill<- ASFL[(ASFL$age_group %in% oldmill),] 
#genx <- ASFL[(ASFL$age_group %in% genx),] 
#babyboom <- ASFL[(ASFL$age_group %in% babyboom),]
#silgen<- ASFL[(ASFL$age_group %in% silgen),] 

under18 <- c("16","17")
ASFLadult <- ASFL[!(ASFL$QD7 %in% under18),]
ASFLadult<- subset(ASFL, ASFL$QD7 >= "18")
above79 <- c("80","81","82","83","84","85","86","87","88","89","90","93","94","95","97")
ASFLmain <- ASFLadult[!(ASFLadult$QD7 %in% above79),] 
ASFLmain<- subset(ASFLadult, ASFLadult$QD7 <= "79")

##################################GENDER##################################
gender <- ASFL$QD1
table(ASFL$QD1)
ASFL <- ASFL %>%
  mutate(gender=case_when(
    gender =="2"~ "Female",
    gender =="1"~ "Male",
    TRUE ~ "Other"
  ))
maled<- ifelse(ASFL$QD1 == "1", 1, 0)
genderd<- ifelse(ASFL$QD1 == "1", 1, 0) #to avoid problems with the maled dummy in later analysis
femaled <- ifelse(ASFL$QD1 == "2", 1, 0)

male <- c("1")
female <- c("2")

ASFL <- cbind(ASFL,maled,femaled,genderd)

##################################EDUCATION##################################
#################################old_education###################################
ASFL <- ASFL %>% mutate(QD9 = ifelse(is.na(QD9), 0, QD9))
ASFL$QD9
table(ASFL$QD9)
ASFL["educationspecific"] = cut(as.numeric(as.character(ASFL$QD9)), c(0,1, 3, 4, 5, Inf), c("Akademie","Universitary", "Upper secondary", "Lower secondary", "Primary"), include.lowest=TRUE)
table(ASFL$educationspecific)
primary_1d <- ifelse(ASFL$QD9 == "7", 1, 0)
primary_2d <- ifelse(ASFL$QD9 == "6", 1, 0)
primaryd <- primary_1d+primary_2d
lowersecondaryd<- ifelse(ASFL$QD9 == "5", 1, 0)
uppersecondaryd<- ifelse(ASFL$QD9 == "4", 1, 0)
university_1d<- ifelse(ASFL$QD9 == "2", 1, 0)
university_2d<- ifelse(ASFL$QD9 == "3", 1, 0)
Akademied <- ifelse(ASFL$QD9 == "0", 1, 0)#Akademie!
universityd <- university_1d+university_2d

ASFL <- cbind(ASFL,primaryd,lowersecondaryd,uppersecondaryd,universityd,Akademied)

#################################new_education###################################
ASFL["education"] = cut(as.numeric(as.character(ASFL$QD9)), c(0,4,Inf), c("Higher", "Lower"), include.lowest=TRUE)
table(ASFL$education)
higheduc<- ifelse(ASFL$education == "Higher", 1, 0)
heduc <- c("Higher")
loweduc<- ifelse(ASFL$education == "Lower", 1, 0)
ASFL <- cbind(ASFL,higheduc,loweduc)
leduc <- c("Lower")


#################################add_education###################################

summary(ASFL$st1g) #highest attained education
table(ASFL_org$QD9) #redefined for OECD! 

summary(ASFL$st3g)

#################################SELF-ASSESSMENT##############################
selfassess <- ASFL$QK1
table(selfassess)
table(ASFL$QK1)
ASFL <- ASFL %>% mutate(saknow_group = case_when(selfassess == "Very high" ~ "High sa",
                                                 selfassess == "Quite high" ~ "High sa",
                                                 selfassess == "About average" ~ "Average sa",
                                                 selfassess == "Very low" ~ "Low sa",
                                                 selfassess == "Quite low" ~ "Low sa",
                                                 selfassess == "Refused" ~ "Ref/Don't know",
                                                 selfassess == "Don't know" ~ "Ref/Don't know"))
ASFL <- ASFL %>% mutate(saknow_group_a = case_when(selfassess == "Very high" ~ "High sa",
                                                   selfassess == "Quite high" ~ "High sa",
                                                   selfassess == "About average" ~ "Average sa",
                                                   selfassess == "Very low" ~ "Low sa",
                                                   selfassess == "Quite low" ~ "Low sa",
                                                   selfassess == TRUE ~ NA))                               
table(ASFL$saknow_group)
saknow_group_1 <- factor(ASFL$saknow_group, levels=c("High sa", "Average sa", "Low sa","Ref/Don't know"))
levels(saknow_group_1)
saknow_group_a_1 <- factor(ASFL$saknow_group_a, levels=c("High sa", "Average sa", "Low sa"))
levels(saknow_group_a_1)

hhsfknow<- ifelse(ASFL$QK1 == "Very high", 1, 0)
hsfknow<- ifelse(ASFL$QK1 == "Quite high", 1, 0)
highsfknow <- hsfknow+hhsfknow
asfknow<- ifelse(ASFL$QK1 == "About average", 1, 0)
lsfknow<- ifelse(ASFL$QK1 == "Quite low", 1, 0)
llsfknow<- ifelse(ASFL$QK1 == "Very low", 1, 0)
lowsfknow <- lsfknow+llsfknow
ASFL <- cbind(ASFL,selfassess,hhsfknow,hsfknow,highsfknow,asfknow,lsfknow,llsfknow,lowsfknow,saknow_group_1,saknow_group_a_1) 

numericsaknow1<- ifelse(ASFL$QK1 == "Very high", 5, 0)
numericsaknow2<- ifelse(ASFL$QK1 == "Quite high", 4, 0)
numericsaknow3<- ifelse(ASFL$QK1 == "About average", 3, 0)
numericsaknow4<- ifelse(ASFL$QK1 == "Quite low", 2, 0)
numericsaknow5<- ifelse(ASFL$QK1 == "Very low", 1, 0)
numericsaknow6<- ifelse(ASFL$QK1 == "Don't know", 3, 0)
numericsaknow7<- ifelse(ASFL$QK1 == "Refused", 3, 0)

numericsaknow<- numericsaknow1+numericsaknow2+numericsaknow3+numericsaknow4+numericsaknow5+numericsaknow6+numericsaknow7
table(numericsaknow) #higher score indicates higher self-assessment
ASFL <- cbind(ASFL,numericsaknow) 

#################################LIVING COMMUNITY TYPE##############################
livingcomm <- ASFL$QD3
table(ASFL$QD3)
villaged <- ifelse(ASFL$QD3 == "A village, hamlet or rural area (fewer than 3 000 people)", 1, 0)
smalltownd<- ifelse(ASFL$QD3 == "A small town (3 000 to about 15 000 people)", 1, 0)
largetownd<- ifelse(ASFL$QD3 == "A town (15 000 to about 100 000 people)", 1, 0)
townd <- smalltownd+largetownd
smallcityd<- ifelse(ASFL$QD3 == "A city (100 000 to about 1 000 000 people)", 1, 0)
largecityd<- ifelse(ASFL$QD3 == "A large city (with over 1 000 000 people)", 1, 0)
cityd<- smallcityd+largecityd

ASFL <- ASFL %>% mutate(livingcommgroup = case_when(livingcomm == "A village, hamlet or rural area (fewer than 3 000 people)" ~ "Village",
                                                    livingcomm == "A small town (3 000 to about 15 000 people)" ~ "Town",
                                                    livingcomm == "A town (15 000 to about 100 000 people)" ~ "Town",
                                                    livingcomm == "A city (100 000 to about 1 000 000 people)" ~ "City",
                                                    livingcomm == "A large city (with over 1 000 000 people)" ~ "City"))

livingcommgroup_1 <- factor(ASFL$livingcommgroup, levels=c("Village", "Town", "City"))
ASFL <- cbind(ASFL,livingcommgroup_1)
levels(ASFL$livingcommgroup_1)
table(livingcommgroup_1)

ASFL <- cbind (ASFL, villaged, townd, cityd)
#################################HOUSEHOLD INCOME##############################
hincome <- ASFL$QD13
table(ASFL$QD13)
hincomehighd<- ifelse(ASFL$QD13 == "Y or more a month", 1, 0) 
hincomemiddled<- ifelse(ASFL$QD13 == "Between X and Y a month", 1, 0) 
hincomelowd <- ifelse(ASFL$QD13 == "Up to X a month", 1, 0) 
refincome1 <- ifelse(ASFL$QD13 == "Refused", 1, 0) 
refincome2 <- ifelse(ASFL$QD13 == "Don't know", 1, 0) 
refincomed <- refincome1 + refincome2
ASFL <- cbind(ASFL,hincome,hincomehighd,hincomemiddled,hincomelowd,refincomed) 
ASFL <- ASFL %>% mutate(incomegroup = case_when(hincome == "Refused" ~ "Ref/Don't know",
                                                hincome == "Don't know" ~ "Ref/Don't know",
                                                hincome == "Y or more a month" ~ "High income",
                                                hincome == "Between X and Y a month" ~ "Middle income",
                                                hincome == "Up to X a month" ~ "Low income"))

ASFL <- ASFL %>% mutate(incomegroup_simple = case_when(hincome == "Up to X a month" ~ "Low income",
                                                       hincome == "Between X and Y a month" ~ "Middle income",
                                                       hincome == "Y or more a month" ~ "High income", 
                                                       TRUE ~NA))

incomegroup_1 <- factor(ASFL$incomegroup, levels=c("Ref/Don't know", "Low income", "Middle income", "High income"))
ASFL <- cbind(ASFL, incomegroup_1)
levels(ASFL$incomegroup_1)

incomegroup_simple_1 <- factor(ASFL$incomegroup_simple, levels=c("Low income", "Middle income", "High income"))
ASFL <- cbind(ASFL, incomegroup_simple_1)
levels(ASFL$incomegroup_simple_1)


table(ASFL$incomegroup)
table(ASFL$incomegroup_simple)
incomeequ <- subset(ASFL, select=c("QD13", "QD5_ad"))
incomeequ
partnerhincome <- ifelse(incomeequ$QD5_ad == "2", 1, 0) 
partnerhincome<- subset(incomeequ, incomeequ$QD5_ad == "2")
table(partnerhincome)
table(ASFL$QD13)
table(incomeequ$QD5_ad)
table(incomeequ$QD13)
#################################HOUSEHOLD SIZE & CHILDREN##############################
table(ASFL$QD5_1)
singled <- ifelse(ASFL$QD5_1 == "Yes", 1, 0)
ASFL<- cbind(ASFL, singled)
table(ASFL$QD5_ad) #only those stating that they are not living alone
table(ASFL$QD5_3)
table(ASFL$QD5_4)
table(ASFL$QD5_ch) #only those stating that they are not living alone asked for amount of children
cb18d <- ifelse(ASFL$QD5_3 == "Yes", 1, 0)
ca18d <- ifelse(ASFL$QD5_4 == "Yes", 1, 0)
child <- cb18d+ca18d
childd <- ifelse(child  >= "1", 1, 0)
ASFL <- cbind(ASFL, childd,cb18d,ca18d)
singleparentb18d <- ifelse(ASFL$QD5_ad == "1", 1, 0) #notlivingalone but only 1 person (including respondent themselve) above 18
singleparent_2_1 <- ifelse(ASFL$QD5_ad == "2", 1, 0)
singleparent_2_2 <-ca18d+singleparent_2_1
singleparent_2 <- ifelse(singleparent_2_2 == "2", 1, 0)
singleparentd <- singleparentb18d+singleparent_2
ASFL <- cbind(ASFL, singleparentb18d,singleparentd)
table(ASFL$singleparentd)
##################################FINANCIAL RESILIENCE##################################
finbuff <- ASFL$QF13
table(finbuff)
lfinbuff<- c("Less than a week","At least a week, but not one month","At least one month, but not three months") 
hfinbuff<- c("At least three months, but not six months","Six months or more")

ASFL <- ASFL %>% mutate(finbuff_group = case_when(finbuff == "Less than a week" ~ 'Low',
                                                  finbuff == "At least a week, but not one month" ~ 'Low',
                                                  finbuff == "At least one month, but not three months" ~ 'Average',
                                                  finbuff == "At least three months, but not six months" ~ 'High',
                                                  finbuff == "Six months or more" ~ 'High', 
                                                  finbuff == "Don't know" ~ 'Refusal',
                                                  finbuff == "Refused" ~ 'Refusal'))
table(ASFL$finbuff_group)

numericfinbuff1<- ifelse(ASFL$QF13 == "Refusal", 3, 0)
numericfinbuff2<- ifelse(ASFL$QF13 == "Don't know", 3, 0)
numericfinbuff3<- ifelse(ASFL$QF13 == "At least one month, but not three months", 3, 0)
numericfinbuff4<- ifelse(ASFL$QF13 == "Less than a week", 1, 0)
numericfinbuff5<- ifelse(ASFL$QF13 == "At least a week, but not one month", 2, 0)
numericfinbuff6<- ifelse(ASFL$QF13 == "At least three months, but not six months", 4, 0)
numericfinbuff7<- ifelse(ASFL$QF13 == "Six months or more", 5, 0)

numericfinbuff <- numericfinbuff1+numericfinbuff2+numericfinbuff3+numericfinbuff4+numericfinbuff5+numericfinbuff6+numericfinbuff7
table(numericfinbuff)
ASFL <- cbind(ASFL,numericfinbuff)


lessweekfinbuffd <-ifelse(ASFL$QF13 == "Less than a week", 1, 0)
weekfinbuffd <-ifelse(ASFL$QF13 == "At least a week, but not one month", 1, 0)
monthfinbuffd <-ifelse(ASFL$QF13 == "At least one month, but not three months", 1, 0)
lowfinbuffd <- lessweekfinbuffd+weekfinbuffd+monthfinbuffd
threemonthfinbuffd <-ifelse(ASFL$QF13 == "At least three months, but not six months", 1, 0)
sixmonthfinbuffd <-ifelse(ASFL$QF13 == "Six months or more", 1, 0)
highfinbuffd <-threemonthfinbuffd+sixmonthfinbuffd
ASFL <- cbind(ASFL,lessweekfinbuffd,weekfinbuffd,monthfinbuffd,lowfinbuffd,threemonthfinbuffd,sixmonthfinbuffd,highfinbuffd) 


#########################SOCIODEMOGRAPHIC CHARACTERISTICS##########################################

##################################EMPLOYMENT##################################
############graphic overview#################
empl <- round(c(79/1418,699/1418,494/1418,50/1418,5/1418,23/1418,24/1418,21/1418,23/1418), digits=4)
paste(round(100*empl, 2), "%", sep="")
emplshare <- data.frame("Employment" = c("Self-employed", "Employed","Retired", "Unemployed", "Apprentice", "Student", "Home",  "Not working", "Other"),
                        "amount" = c(79/1418,699/1418,494/1418,50/1418,5/1418,23/1418,24/1418,21/1418,23/1418))


ggplot(emplshare, aes(x="", y=amount, fill=Employment)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  geom_text(aes(label = c("5.57%" , "49.29%", "34.84%" ,"3.53%","" , "" , "",  "" , "" )),
            position = position_stack(vjust = 0.4))+
  #geom_text(aes(label = c("5.57%" , "49.29%", "34.84%" ,"3.53%","0.35%" , "1.62%" , "1.69%",  "1.48%" , "1.62%" )),
  #    position = position_stack(vjust = 0.4))+
  theme_void()

emplshare2 <- data.frame("Employment" = c("Self-employed", "Employed", "Other", "Retired"),
                         "amount" = c(79/1418,699/1418,146/1418,494/1418))

ggplot(emplshare2, aes(x="", y=amount, fill=Employment)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  theme_void()


##################################AGE##################################
#absolute comparison
summary(ASFL$QD7)
ASFLse <- ASFL[(ASFL$QD10 %in% se),] 
summary(ASFLse$QD7)
ASFLe <- ASFL[(ASFL$QD10 %in% e),] 
summary(ASFLe$QD7)
ASFLeu <- ASFL[(ASFL$QD10 %in% eu),] 
summary(ASFLeu$QD7)
ASFLoth <-  ASFL[(ASFL$QD10 %in% oth),] 
summary(ASFLoth$QD7)
ASFLothworet <-  ASFL[(ASFL$QD10 %in% othworet),] 
summary(ASFLothworet$QD7)
ASFLret <-  ASFL[(ASFL$QD10 %in% ret),] 
summary(ASFLret$QD7)
ASFLunempl <-  ASFL[(ASFL$QD10 %in% unempl),] 
summary(ASFLunempl$QD7)
ASFLentrepreneurs <-  ASFL[(ASFL$QF9_11 %in% entrepreneurs),] 
summary(ASFLentrepreneurs$QD7)


#age group comparison
#full sample
ASFL$QD7
ASFL["age_group"] = cut(as.numeric(as.character(ASFL$QD7)), c(16, 28, 38, 58, 74, Inf), c("16-28", "29-38", "39-58", "59-74", ">75"), include.lowest=TRUE)
youngmill_f<- ifelse(ASFL$age_group == "16-28", 1, 0)
oldmill_f<- ifelse(ASFL$age_group == "29-38", 1, 0)
genx_f <- ifelse(ASFL$age_group == "39-58", 1, 0)
babyboom_f <- ifelse(ASFL$age_group == "59-74", 1, 0)
silentgen_f<- ifelse(ASFL$age_group == ">75", 1, 0)
summary(ASFL$age_group)
#158/1418, 198/1418, 515/1418, 354/1418, 193/1418

#self-employed
summary(ASFLse$QD7)
ASFLse["age_group"] = cut(as.numeric(as.character(ASFLse$QD7)), c(16, 28, 38, 58, 74, Inf), c("16-28", "29-38", "39-58", "59-74", ">75"), include.lowest=TRUE)
youngmill_se<- ifelse(ASFLse$age_group == "16-28", 1, 0)
oldmill_se<- ifelse(ASFLse$age_group == "29-38", 1, 0)
genx_se<- ifelse(ASFLse$age_group == "39-58", 1, 0)
babyboom_se <- ifelse(ASFLse$age_group == "59-74", 1, 0)
silentgen_se<- ifelse(ASFLse$age_group == ">75", 1, 0)
summary(ASFLse$age_group)
summary(ASFLse$age_group)/79

#employed
#e
summary(ASFLe$QD7)
ASFLe["age_group"] = cut(as.numeric(as.character(ASFLe$QD7)), c(16, 28, 38, 58, 74, Inf), c("16-28", "29-38", "39-58", "59-74", ">75"), include.lowest=TRUE)
youngmill_e<- ifelse(ASFLe$age_group == "16-28", 1, 0)
oldmill_e<- ifelse(ASFLe$age_group == "29-38", 1, 0)
genx_e <- ifelse(ASFLe$age_group == "39-58", 1, 0)
babyboom_e <- ifelse(ASFLe$age_group == "59-74", 1, 0)
silentgen_e<- ifelse(ASFLe$age_group == ">75", 1, 0)
summary(ASFLe$age_group)
summary(ASFLe$age_group)/699
#e+u
summary(ASFLeu$QD7)
ASFLeu["age_group"] = cut(as.numeric(as.character(ASFLeu$QD7)), c(16, 28, 38, 58, 74, Inf), c("16-28", "29-38", "39-58", "59-74", ">75"), include.lowest=TRUE)
youngmill_eu<- ifelse(ASFLeu$age_group == "16-28", 1, 0)
oldmill_eu<- ifelse(ASFLeu$age_group == "29-38", 1, 0)
genx_eu <- ifelse(ASFLeu$age_group == "39-58", 1, 0)
babyboom_eu <- ifelse(ASFLeu$age_group == "59-74", 1, 0)
silentgen_eu<- ifelse(ASFLeu$age_group == ">75", 1, 0)
summary(ASFLeu$age_group)
#123/749, 174/749, 414/749, 37/749, 1/749

#others
summary(ASFLoth$QD7)
ASFLoth["age_group"] = cut(as.numeric(as.character(ASFLoth$QD7)), c(16, 28, 38, 58, 74, Inf), c("16-28", "29-38", "39-58", "59-74", ">75"), include.lowest=TRUE)
youngmill_eu<- ifelse(ASFLoth$age_group == "16-28", 1, 0)
oldmill_eu<- ifelse(ASFLoth$age_group == "29-38", 1, 0)
genx_eu <- ifelse(ASFLoth$age_group == "39-58", 1, 0)
babyboom_eu <- ifelse(ASFLoth$age_group == "59-74", 1, 0)
silentgen_eu<- ifelse(ASFLoth$age_group == ">75", 1, 0)
summary(ASFLoth$age_group)
#44/640,30/640,66/640,308/640,192/640

#retired
summary(ASFLret$QD7)
table(ASFLret$age_group)
table(ASFLret$age_group)/494
#othersworetired
summary(ASFLothworet$QD7)
table(ASFLothworet$age_group)
table(ASFLothworet$age_group)/146
#unemployed
summary(ASFLunempl$QD7)
table(ASFLunempl$age_group)
table(ASFLunempl$age_group)/50
#entrepreneurs
summary(ASFLentrepreneurs$QD7)
table(ASFLentrepreneurs$age_group)
table(ASFLentrepreneurs$age_group)/19
###age group comparison plot 
gencomp <- data.frame(status=rep(c('Self-employed', 'Employed'), each=5),
                      age=rep(c('Young millenials', 'Old millenials', 'Generation X', 'Baby boomers', 'Silent generation ' ), times=2),
                      share=c(0/79,5/79,63/79,11/79,0/79, 114/699,163/699,386/699,35/699,1/699))
gencomp$status<- factor(gencomp$status, levels=c('Self-employed', 'Employed'))
gencomp$age<- factor(gencomp$age, levels=c('Young millenials', 'Old millenials', 'Generation X', 'Baby boomers', 'Silent generation '))
ggplot(gencomp, aes(fill=age, y=share, x=status)) + 
  geom_bar(position='stack', stat='identity')+
  labs(x="",y="Percentage share",fill="")
###with others
gencomp <- data.frame(status=rep(c('Self-employed', 'Employed','Others'), each=5),
                      age=rep(c('Young millenials', 'Old millenials', 'Generation X', 'Baby boomers', 'Silent generation ' ), times=3),
                      share=c(0/79,5/79,63/79,11/79,0/79, 114/699,163/699,386/699,35/699,1/699,44/640,30/640,66/640,308/640,192/640))
gencomp$status<- factor(gencomp$status, levels=c('Self-employed', 'Employed','Others'))
gencomp$age<- factor(gencomp$age, levels=c('Young millenials', 'Old millenials', 'Generation X', 'Baby boomers', 'Silent generation '))
ggplot(gencomp, aes(fill=age, y=share, x=status)) + 
  geom_bar(position='stack', stat='identity')+
  labs(x="",y="Percentage share",fill="Employment status")


##################################GENDER##################################
table(ASFL$QD1)
#full
female_f <- ifelse(ASFL$QD1 == "2", 1, 0)
female_f
male_f <- ifelse(ASFL$QD1 == "1", 1, 0)
male_f

#self-employed
table(ASFLse$QD1)
table(ASFLse$QD1)/79
female_se <- ifelse(ASFLse$QD1 == "2", 1, 0)
female_se
male_se <- ifelse(ASFLse$QD1 == "1", 1, 0)
male_se

#employed
table(ASFLe$QD1)
table(ASFLe$QD1)/699
female_e <- ifelse(ASFLe$QD1 == "2", 1, 0)
female_e
male_e <- ifelse(ASFLe$QD1 == "1", 1, 0)
male_e
#e+u
table(ASFLeu$QD1)
female_eu <- ifelse(ASFLeu$QD1 == "2", 1, 0)
female_eu
male_eu <- ifelse(ASFLeu$QD1 == "1", 1, 0)
male_eu

#others
table(ASFLoth$QD1)
female_oth <- ifelse(ASFLoth$QD1 == "2", 1, 0)
female_oth
male_oth <- ifelse(ASFLoth$QD1 == "1", 1, 0)
male_oth
#retired
table(ASFLret$QD1)
table(ASFLret$QD1)/494
#otherswithout retired
table(ASFLothworet$QD1)
table(ASFLothworet$QD1)/146
female_othworet <- ifelse(ASFLothworet$QD1 == "2", 1, 0)
female_othworet
male_othworet <- ifelse(ASFLothworet$QD1 == "1", 1, 0)
male_othworet
#unemployed
table(ASFLunempl$QD1)
table(ASFLunempl$QD1)/50
#entrepreneurs
table(ASFLentrepreneurs$QD1)
table(ASFLentrepreneurs$QD1)/19


#gender comparison plot 
emplstat <- c(rep("Self-employed" , 2) , rep("Employed" , 2) )
gender <- rep(c("Male" , "Female" ) , 2)
value <- abs(c(45/79,34/79,346/699,353/699))
genderplot<- data.frame(gender,emplstat,value)

genderplot$emplstat<- factor(genderplot$emplstat, levels=c('Self-employed', 'Employed'))
genderplot$gender<- factor(genderplot$gender, levels=c('Male','Female'))
ggplot(genderplot, aes(fill=gender, y=value, x=emplstat)) + 
  geom_bar(position="dodge", stat="identity")+ 
  scale_fill_manual(values=c("grey",
                             "orange"))+
  labs(x="" ,y="Percentage share",fill="")

#with others
emplstat <- c(rep("Self-employed" , 2) , rep("Employed" , 2) ,  rep("Others" , 2) )
gender <- rep(c("Male" , "Female" ) , 3)
value <- abs(c(45/79,34/79,346/699,353/699,277/640,363/640))
genderplot<- data.frame(gender,emplstat,value)

genderplot$emplstat<- factor(genderplot$emplstat, levels=c('Self-employed', 'Employed', 'Others'))
genderplot$gender<- factor(genderplot$gender, levels=c('Male','Female'))
ggplot(genderplot, aes(fill=gender, y=value, x=emplstat)) + 
  geom_bar(position="dodge", stat="identity")+ labs(x="" ,y="Percentage share",fill="Gender")


##################################EDUCATION##################################
#oldeduc
table(ASFL$QD9)
table(ASFL_add$st1g)
table(ASFL_org$QD9)
#selfemployed
ASFLse$QD9
ASFLse <- ASFLse %>% mutate(QD9 = ifelse(is.na(QD9), 0, QD9))
primary_se <- ifelse(ASFLse$QD9 == c("6"), 1, 0) ##none with no formal education
lowersecondary_se<- ifelse(ASFLse$QD9 == "5", 1, 0)
uppersecondary_se<- ifelse(ASFLse$QD9 == "4", 1, 0)
university_se_1<- ifelse(ASFLse$QD9 == "2", 1, 0)
university_se_2<- ifelse(ASFLse$QD9 == "3", 1, 0)
university_se <- university_se_1+university_se_2
Akademiese <- ifelse(ASFLse$QD9 == "0", 1, 0)
table(ASFLse$QD9)

#employed
#e
ASFLe$QD9
ASFLe <- ASFLe %>% mutate(QD9 = ifelse(is.na(QD9), 0, QD9))
primary_e_1 <- ifelse(ASFLe$QD9 == "7", 1, 0)
primary_e_2 <- ifelse(ASFLe$QD9 == "6", 1, 0)
primary_e <- primary_e_1+primary_e_2
lowersecondary_e<- ifelse(ASFLe$QD9 == "5", 1, 0)
uppersecondary_e<- ifelse(ASFLe$QD9 == "4", 1, 0)
university_e_1<- ifelse(ASFLe$QD9 == "2", 1, 0)
university_e_2<- ifelse(ASFLe$QD9 == "3", 1, 0)
university_e <- university_e_1+university_e_2
Akademiee <- ifelse(ASFLe$QD9 == "0", 1, 0)
table(ASFLe$QD9)

#e+u
ASFLeu$QD9
ASFLeu <- ASFLeu %>% mutate(QD9 = ifelse(is.na(QD9), 0, QD9))
primary_eu_1 <- ifelse(ASFLeu$QD9 == "7", 1, 0)
primary_eu_2 <- ifelse(ASFLeu$QD9 == "6", 1, 0)
primary_eu <- primary_eu_1+primary_eu_2
lowersecondary_eu<- ifelse(ASFLeu$QD9 == "5", 1, 0)
uppersecondary_eu<- ifelse(ASFLeu$QD9 == "4", 1, 0)
university_eu_1<- ifelse(ASFLeu$QD9 == "2", 1, 0)
university_eu_2<- ifelse(ASFLeu$QD9 == "3", 1, 0)
university_eu <- university_eu_1+university_eu_2
Akademieeu <- ifelse(ASFLeu$QD9 == "0", 1, 0)
table(ASFLeu$QD9)

#others
table(ASFLoth$QD9)
#skip NAs
ASFLoth <- ASFLoth %>% mutate(QD9 = ifelse(is.na(QD9), 0, QD9))
primary_oth_1 <- ifelse(ASFLoth$QD9 == "7", 1, 0)
primary_oth_2 <- ifelse(ASFLoth$QD9 == "6", 1, 0)
primary_oth <- primary_oth_1+primary_oth_2
lowersecondary_oth<- ifelse(ASFLoth$QD9 == "5", 1, 0)
uppersecondary_oth<- ifelse(ASFLoth$QD9 == "4", 1, 0)
university_oth_1<- ifelse(ASFLoth$QD9 == "2", 1, 0)
university_oth_2<- ifelse(ASFLoth$QD9 == "3", 1, 0)
university_oth <- university_oth_1+university_oth_2
Akademieoth <- ifelse(ASFLoth$QD9 == "0", 1, 0)
table(ASFLoth$QD9)

#unemployed
table(ASFLunempl$QD9)
#retired
table(ASFLret$QD9)
#entrepreneurs
table(ASFLentrepreneurs$QD9)


###education comparison plot
###stacked bar chart ##OLD!
educomp <- data.frame(status=rep(c('Self-employed', 'Employed','Others'), each=4),
                      education=rep(c('At most primary', 'Lower secondary', 'Upper secondary', 'Tertiary'), times=3),
                      share=c(4/77, 39/77, 11/77, 23/77,42/685, 408/685,138/685,97/685,145/620, 362/620,71/620,42/620))
educomp$status<- factor(educomp$status, levels=c('Self-employed', 'Employed','Others'))
educomp$education<- factor(educomp$education, levels=c('At most primary', 'Lower secondary', 'Upper secondary', 'Tertiary'))
ggplot(educomp, aes(fill=education, y=share, x=status)) + 
  geom_bar(position='stack', stat='identity')+
  labs(x="",y="Percentage share",fill="Education")

#####new education variable
#refusals
ASFLeduc <- subset(ASFL_full, select=c("QD9", "st1g")) #all refusing visit an "Akademie" - not internationally comparable
educQD9NA <- ifelse(ASFLeduc$st1g == "Akademie (z.B. Pädagogische Hochschule, Sozialakademie, Kolleg usw)", 1, 0)
ASFLeduc <- cbind(ASFLeduc, educQD9NA)

#self-employed 
table(ASFLse$education)
table(ASFLse$education)/79
higheducse <- ifelse(ASFLse$education == "Higher", 1, 0)
loweducse <- ifelse(ASFLse$education == "Lower", 1, 0)

#employed 
table(ASFLe$education)
table(ASFLe$education)/699
higheduce <- ifelse(ASFLe$education == "Higher", 1, 0)
loweduce <- ifelse(ASFLe$education == "Lower", 1, 0)
#e+u
table(ASFLeu$education)

#others 
table(ASFLoth$education)
higheducoth <- ifelse(ASFLoth$education == "Higher", 1, 0)
loweducoth <- ifelse(ASFLoth$education == "Lower", 1, 0)
#retired
table(ASFLret$education)
table(ASFLret$education)/494
#othersworetired
table(ASFLothworet$education)
table(ASFLothworet$education)/146
higheducothworet <- ifelse(ASFLothworet$education == "Higher", 1, 0)
loweducothworet <- ifelse(ASFLothworet$education == "Lower", 1, 0)
#unemployed 
table(ASFLunempl$education)
table(ASFLunempl$education)/50
#entrepreneurs
table(ASFLentrepreneurs$education)
table(ASFLentrepreneurs$education)/19


#comparison plots
educomp <- data.frame(status=rep(c('Self-employed', 'Employed'), each=2),
                      education=rep(c('Higher', 'Lower'), times=2),
                      share=c(36/79, 43/79,249/699, 450/699))
educomp$status<- factor(educomp$status, levels=c('Self-employed', 'Employed'))
educomp$education<- factor(educomp$education, levels=c('Higher', 'Lower'))
ggplot(educomp, aes(fill=education, y=share, x=status)) + 
  geom_bar(position='stack', stat='identity')+
  scale_fill_manual(values=c("green",
                             "purple"))+
  labs(x="",y="Percentage share",fill="")



##################################HOUSEHOLD SIZE##################################
#full
table(ASFL$QD5_1)
471/(947+471)
single_f <- ifelse(ASFL$QD5_1 == "Yes", 1, 0)
#self-employed
table(ASFLse$QD5_1)
table(ASFLse$QD5_1)/79
23/(56+23)
table(ASFLse$QD5_2)
table(ASFLse$QD5_ad)
single_se <- ifelse(ASFLse$QD5_1 == "Yes", 1, 0)
#employed
table(ASFLe$QD5_1)
table(ASFLe$QD5_1)/699
table(ASFLe$QD5_2)
table(ASFLe$QD5_ad)
single_e <- ifelse(ASFLe$QD5_1 == "Yes", 1, 0)
#e+u
table(ASFLeu$QD5_1)
single_eu <- ifelse(ASFLeu$QD5_1 == "Yes", 1, 0)
218/(531+218)
#others
table(ASFLoth$QD5_1)
single_oth <- ifelse(ASFLoth$QD5_1 == "Yes", 1, 0)
252/(252+388)
#retired
table(ASFLret$QD5_1)
table(ASFLret$QD5_1)/494
#others without retired
table(ASFLothworet$QD5_1)
table(ASFLothworet$QD5_1)/146
single_othworet <- ifelse(ASFLothworet$QD5_1 == "Yes", 1, 0)
50/(50+96)
#unemployed
table(ASFLunempl$QD5_1)
table(ASFLunempl$QD5_1)/50
#entrepreneurs
table(ASFLentrepreneurs$QD5_1)
table(ASFLentrepreneurs$QD5_1)/19

##################################children##################################
#full
table(ASFL$QD5_3) #children below 18
table(ASFL$QD5_4)  #children above 18
cb18_f <- ifelse(ASFL$QD5_3 == "Yes", 1, 0)
ca18_f <- ifelse(ASFL$QD5_4 == "Yes", 1, 0)
child_f <- cb18_f+ca18_f
child_f <- ifelse(child_f  >= "1", 1, 0)
table(cb18_f)
table(ca18_f)
table(child_f)
351/(1418)

#self-employed
table(ASFLse$QD5_3)
table(ASFLse$QD5_4)
table(ASFLse$QD5_ch)
table(ASFLse$singleparentd)
singleparentse <- ifelse(ASFLse$singleparentd == "1", 1, 0)
singleparentu18se <- ifelse(ASFLse$QD5_ad == "1", 1, 0)
cb18_se <- ifelse(ASFLse$QD5_3 == "Yes", 1, 0)
ca18_se <- ifelse(ASFLse$QD5_4 == "Yes", 1, 0)
child_se <- cb18_se+ca18_se
child_se  <- ifelse(child_se  >= "1", 1, 0)
table(cb18_se)
table(ca18_se)
table(child_se)
table(ASFLse$childd)
table(ASFLse$childd)/79

#employed
table(ASFLe$QD5_3)
table(ASFLe$QD5_4)
table(ASFLe$QD5_ch)
table(ASFLe$singleparentd)
singleparente <- ifelse(ASFLe$singleparentd == "1", 1, 0)
singleparentu18e <- ifelse(ASFLe$QD5_ad == "1", 1, 0)
cb18_e <- ifelse(ASFLe$QD5_3 == "Yes", 1, 0)
ca18_e <- ifelse(ASFLe$QD5_4 == "Yes", 1, 0)
child_e <- cb18_e+ca18_e
child_e  <- ifelse(child_e  >= "1", 1, 0)
table(cb18_e)
table(ca18_e)
table(child_e)
table(ASFLe$childd)
table(ASFLe$childd)/699

#e+u
table(ASFLeu$QD5_3)
table(ASFLeu$QD5_4)
table(ASFLeu$QD5_ch)
table(ASFLeu$singleparentd)
cb18_eu <- ifelse(ASFLeu$QD5_3 == "Yes", 1, 0)
ca18_eu <- ifelse(ASFLeu$QD5_4 == "Yes", 1, 0)
child_eu <- cb18_eu+ca18_eu
child_eu  <- ifelse(child_eu  >= "1", 1, 0)
table(cb18_eu)
table(ca18_eu)
table(child_eu)
245/699

#others
table(ASFLoth$QD5_3)
table(ASFLoth$QD5_4)
table(ASFLoth$QD5_ch)
table(ASFLoth$singleparentd)
cb18_oth <- ifelse(ASFLoth$QD5_3 == "Yes", 1, 0)
ca18_oth <- ifelse(ASFLoth$QD5_4 == "Yes", 1, 0)
child_oth <- cb18_oth+ca18_oth
child_oth  <- ifelse(child_oth  >= "1", 1, 0)
table(cb18_oth)
table(ca18_oth)
table(child_oth)
77/640

#retired
table(ASFLret$cb18d)
table(ASFLret$ca18d)
table(ASFLret$childd)
table(ASFLret$childd)/494
table(ASFLret$singleparentd)

#others without retired
table(ASFLothworet$QD5_3)
table(ASFLothworet$QD5_4)
table(ASFLothworet$childd)
table(ASFLothworet$childd)/146
table(ASFLothworet$singleparentd)
cb18_othworet <- ifelse(ASFLothworet$QD5_3 == "Yes", 1, 0)
ca18_othworet <- ifelse(ASFLothworet$QD5_4 == "Yes", 1, 0)
child_othworet <- cb18_othworet+ca18_othworet
child_othworet  <- ifelse(child_othworet  >= "1", 1, 0)
table(cb18_othworet)
table(ca18_othworet)
table(child_othworet)
55/146
#unemployed
table(ASFLunempl$cb18d)
table(ASFLunempl$ca18d)
table(ASFLunempl$childd)
table(ASFLunempl$childd)/50
table(ASFLunempl$singleparentd)
#entrepreneurs
table(ASFLentrepreneurs$cb18d)
table(ASFLentrepreneurs$ca18d)
table(ASFLentrepreneurs$childd)
table(ASFLentrepreneurs$childd)/19
table(ASFLentrepreneurs$singleparentd)

#sole and with children comparison plot
household <- c(rep("Single household" , 2) , rep("Children" , 2), rep("Single parent" , 2))
emplstat <- rep(c("Self-employed" , "Employed" ) , 3)
value <- abs(c(23/79,196/699,29/79,245/699,3/79,34/699))
householdplot<- data.frame(household,emplstat,value)
householdplot$household<- factor(householdplot$household, levels=c("Single household","Children","Single parent"))
householdplot$emplstat<- factor(householdplot$emplstat, levels=c('Self-employed', 'Employed'))
ggplot(householdplot, aes(fill=emplstat, y=value, x=household)) + 
  geom_bar(position="dodge", stat="identity")+
  labs(x = "",y="Percentage share", fill = "Employment status")

#with others
household <- c(rep("Single household" , 3) , rep("Children" , 3) )
emplstat <- rep(c("Self-employed" , "Employed","Others" ) , 2)
value <- abs(c(23/79,196/699,252/640,29/79,245/699,77/640))
householdplot<- data.frame(household,emplstat,value)
householdplot$household<- factor(householdplot$household, levels=c("Single household","Children"))
householdplot$emplstat<- factor(householdplot$emplstat, levels=c('Self-employed', 'Employed','Others'))
ggplot(householdplot, aes(fill=emplstat, y=value, x=household)) + 
  geom_bar(position="dodge", stat="identity")+
  labs(x = "",y="Percentage share", fill = "Employment status")
#################################LIVING COMMUNITY TYPE##############################

#self-employed 
table(ASFLse$QD3)
village_se <- ifelse(ASFLse$QD3 == "A village, hamlet or rural area (fewer than 3 000 people)", 1, 0)
smalltown_se<- ifelse(ASFLse$QD3 == "A small town (3 000 to about 15 000 people)", 1, 0)
largetown_se<- ifelse(ASFLse$QD3 == "A town (15 000 to about 100 000 people)", 1, 0)
town_se <- smalltown_se+largetown_se
smallcity_se<- ifelse(ASFLse$QD3 == "A city (100 000 to about 1 000 000 people)", 1, 0)
largecity_se<- ifelse(ASFLse$QD3 == "A large city (with over 1 000 000 people)", 1, 0)
city_se<- smallcity_se+largecity_se


#employed 
table(ASFLe$QD3)
village_e <- ifelse(ASFLe$QD3 == "A village, hamlet or rural area (fewer than 3 000 people)", 1, 0)
smalltown_e<- ifelse(ASFLe$QD3 == "A small town (3 000 to about 15 000 people)", 1, 0)
largetown_e<- ifelse(ASFLe$QD3 == "A town (15 000 to about 100 000 people)", 1, 0)
town_e <- smalltown_e+largetown_e
smallcity_e<- ifelse(ASFLe$QD3 == "A city (100 000 to about 1 000 000 people)", 1, 0)
largecity_e<- ifelse(ASFLe$QD3 == "A large city (with over 1 000 000 people)", 1, 0)
city_e<- smallcity_e+largecity_e

#e+u
table(ASFLeu$QD3)
#others
table(ASFLoth$QD3)
village_oth <- ifelse(ASFLoth$QD3 == "A village, hamlet or rural area (fewer than 3 000 people)", 1, 0)
smalltown_oth<- ifelse(ASFLoth$QD3 == "A small town (3 000 to about 15 000 people)", 1, 0)
largetown_oth<- ifelse(ASFLoth$QD3 == "A town (15 000 to about 100 000 people)", 1, 0)
town_oth <- smalltown_oth+largetown_oth
smallcity_oth<- ifelse(ASFLoth$QD3 == "A city (100 000 to about 1 000 000 people)", 1, 0)
largecity_oth<- ifelse(ASFLoth$QD3 == "A large city (with over 1 000 000 people)", 1, 0)
city_oth<- smallcity_oth+largecity_oth

#othersworetired
table(ASFLothworet$QD3)
village_othworet <- ifelse(ASFLothworet$QD3 == "A village, hamlet or rural area (fewer than 3 000 people)", 1, 0)
smalltown_othworet<- ifelse(ASFLothworet$QD3 == "A small town (3 000 to about 15 000 people)", 1, 0)
largetown_othworet<- ifelse(ASFLothworet$QD3 == "A town (15 000 to about 100 000 people)", 1, 0)
town_othworet <- smalltown_othworet+largetown_othworet
smallcity_othworet<- ifelse(ASFLothworet$QD3 == "A city (100 000 to about 1 000 000 people)", 1, 0)
largecity_othworet<- ifelse(ASFLothworet$QD3 == "A large city (with over 1 000 000 people)", 1, 0)
city_othworet<- smallcity_othworet+largecity_othworet

#unemployed
table(ASFLunempl$QD3)
#retired
table(ASFLret$QD3)
#entrepreneurs
table(ASFLentrepreneurs$QD3)

table(ASFLse$livingcommgroup_1)
table(ASFLse$livingcommgroup_1)/79
table(ASFLe$livingcommgroup_1)
table(ASFLe$livingcommgroup_1)/699
table(ASFLret$livingcommgroup_1)
table(ASFLret$livingcommgroup_1)/494
table(ASFLothworet$livingcommgroup_1)
table(ASFLothworet$livingcommgroup_1)/146
table(ASFLunempl$livingcommgroup_1)
table(ASFLunempl$livingcommgroup_1)/50
table(ASFLentrepreneurs$livingcommgroup_1)
table(ASFLentrepreneurs$livingcommgroup_1)/19

####living community comparison plot
###stacked bar chart 
livingcomm <- data.frame(status=rep(c('Self-employed', 'Employed'), each=3),
                         community=rep(c("Village","Town","City"), times=2),
                         share=c(20/79,25/79,34/79,198/699,258/699,243/699))
livingcomm$status<- factor(livingcomm$status, levels=c('Self-employed', 'Employed'))
livingcomm$community<- factor(livingcomm$community, levels=c("Village","Town","City"))
ggplot(livingcomm, aes(fill=community, y=share, x=status)) + 
  geom_bar(position='stack', stat='identity')+
  labs(x="",y="Percentage share",fill="")


##################################HOUSEHOLD INCOME##################################
#after tax
#full
ASFL$QD13
below2000_f<- ifelse(ASFL$QD13 == "Up to X a month", 1, 0)
between_f<- ifelse(ASFL$QD13 == "Between X and Y a month", 1, 0)
above3300_f<- ifelse(ASFL$QD13 == "Y or more a month", 1, 0)
table(ASFL$QD13)
# 482/1302,508/1302,312/1302

#self-employed
table(ASFLse$QD13)
below2000_se<- ifelse(ASFLse$QD13 == "Up to X a month", 1, 0)
between_se<- ifelse(ASFLse$QD13 == "Between X and Y a month", 1, 0)
above3300_se<- ifelse(ASFLse$QD13 == "Y or more a month", 1, 0)
table(ASFLse$QD13)
#15/69, 18/69, 36/69 

#employed
table(ASFLe$QD13)
below2000_e<- ifelse(ASFLe$QD13 == "Up to X a month", 1, 0)
between_e<- ifelse(ASFLe$QD13 == "Between X and Y a month", 1, 0)
above3300_e<- ifelse(ASFLe$QD13 == "Y or more a month", 1, 0)
table(ASFLe$QD13)
#171/647,264/647,212/647

#e+u
table(ASFLeu$QD13)
below2000_eu<- ifelse(ASFLeu$QD13 == "Up to X a month", 1, 0)
between_eu<- ifelse(ASFLeu$QD13 == "Between X and Y a month", 1, 0)
above3300_eu<- ifelse(ASFLeu$QD13 == "Y or more a month", 1, 0)
table(ASFLeu$QD13)

#others
table(ASFLoth$QD13)
below2000_oth<- ifelse(ASFLoth$QD13 == "Up to X a month", 1, 0)
between_oth<- ifelse(ASFLoth$QD13 == "Between X and Y a month", 1, 0)
above3300_oth<- ifelse(ASFLoth$QD13 == "Y or more a month", 1, 0)
table(ASFLoth$QD13)
#296/586,226/586,64/586 

#others without retired
table(ASFLothworet$QD13)
below2000_othworet<- ifelse(ASFLothworet$QD13 == "Up to X a month", 1, 0)
between_othworet<- ifelse(ASFLothworet$QD13 == "Between X and Y a month", 1, 0)
above3300_othworet<- ifelse(ASFLothworet$QD13 == "Y or more a month", 1, 0)
table(ASFLothworet$QD13)
#75/126,39/126,12/126

table(ASFLse$incomegroup_1)
table(ASFLse$incomegroup_1)/79
table(ASFLe$incomegroup_1)
table(ASFLe$incomegroup_1)/699
table(ASFLret$incomegroup_1)
table(ASFLret$incomegroup_1)/494
table(ASFLothworet$incomegroup_1)
table(ASFLothworet$incomegroup_1)/146
table(ASFLunempl$incomegroup_1)
table(ASFLunempl$incomegroup_1)/50
table(ASFLentrepreneurs$incomegroup_1)
table(ASFLentrepreneurs$incomegroup_1)/19


####household income comparison plot 
hincomecomp <- data.frame(status=rep(c('Self-employed', 'Employed'), each=4),
                          income=rep(c('3.000 or more','Between 2.000 and 3.000','Up to 2.000', 'Ref/Don`t know'), times=2),
                          share=c( 36/79, 18/79, 15/79,10/79,212/699,264/699,171/699,52/699))
hincomecomp$status<- factor(hincomecomp$status, levels=c('Self-employed', 'Employed'))
hincomecomp$income<- factor(hincomecomp$income, levels=c('3.000 or more','Between 2.000 and 3.000','Up to 2.000', 'Ref/Don`t know'))
ggplot(hincomecomp, aes(fill=income, y=share, x=status)) + 
  geom_bar(position='stack', stat='identity')+
  labs(x="",y="Percentage share",fill="")

###with others
hincomecomp <- data.frame(status=rep(c('Self-employed', 'Employed','Others'), each=3),
                          income=rep(c('Up to 2.000', 'Between 2.000 and 3.000', '3.000 or more'), times=3),
                          share=c(15/69, 18/69, 36/69,171/647,264/647,212/647,296/586,226/586,64/586))
hincomecomp$status<- factor(hincomecomp$status, levels=c('Self-employed', 'Employed','Others'))
hincomecomp$income<- factor(hincomecomp$income, levels=c('Up to 2.000', 'Between 2.000 and 3.000', '3.000 or more'))
ggplot(hincomecomp, aes(fill=income, y=share, x=status)) + 
  geom_bar(position='stack', stat='identity')+
  labs(x="",y="Percentage share",fill="Household income in euros")


##################################SELF-RATED FINANCIAL KNOWLEDGE##################################
#full
selfassess_f <- ASFL$QK1
ASFL$QK1
dontknow_f <- ifelse(ASFL$QK1 == "Don't know", 1, 0)
hhsfknow_f<- ifelse(ASFL$QK1 == "Very high", 1, 0)
hsfknow_f<- ifelse(ASFL$QK1 == "Quite high", 1, 0)
highsfknow_f <- hhsfknow_f+hsfknow_f
asfknow_f<- ifelse(ASFL$QK1 == "About average", 1, 0)
lsfknow_f<- ifelse(ASFL$QK1 == "Quite low", 1, 0)
llsfknow_f<- ifelse(ASFL$QK1 == "Very low", 1, 0)
lowsfknow_f <- lsfknow_f+llsfknow_f
summary(ASFL$QK1)
wpct(ASFL$QK1, weight=ASFL$wght, na.rm=TRUE)
0.095532863+0.299779639 #high
0.404055791 #about average
0.128320735+0.047541960    #low
0.015297688   +0.009471324   #dont know
13+23+143+428+573+178+60


#self-employed
selfassess_se <-ASFLse$QK1
hhsfknow_se<- ifelse(ASFLse$QK1 == "Very high", 1, 0)
hsfknow_se<- ifelse(ASFLse$QK1 == "Quite high", 1, 0)
highsfknow_se <- hhsfknow_se+hsfknow_se
asfknow_se<- ifelse(ASFLse$QK1 == "About average", 1, 0)
lsfknow_se<- ifelse(ASFLse$QK1 == "Quite low", 1, 0)
llsfknow_se<- ifelse(ASFLse$QK1 == "Very low", 1, 0)
lowsfknow_se <- lsfknow_se+llsfknow_se
summary(ASFLse$QK1)
wpct(ASFLse$QK1, weight=ASFLse$wght, na.rm=TRUE)

ASFLsem <- ASFLse[(ASFLse$QD1 %in% male),] 
ASFLsef <- ASFLse[(ASFLse$QD1 %in% female),] 
summary(ASFLsem$QK1)
wpct(ASFLsem$QK1, weight=ASFLsem$wght, na.rm=TRUE)
summary(ASFLsef$QK1)
wpct(ASFLsef$QK1, weight=ASFLsef$wght, na.rm=TRUE)

#employed
selfassess_e <- ASFLe$QK1
hhsfknow_e<- ifelse(ASFLe$QK1 == "Very high", 1, 0)
hsfknow_e<- ifelse(ASFLe$QK1 == "Quite high", 1, 0)
highsfknow_e <- hhsfknow_e+hsfknow_e
asfknow_e<- ifelse(ASFLe$QK1 == "About average", 1, 0)
lsfknow_e<- ifelse(ASFLe$QK1 == "Quite low", 1, 0)
llsfknow_e<- ifelse(ASFLe$QK1 == "Very low", 1, 0)
lowsfknow_e <- lsfknow_e+llsfknow_e
summary(ASFLe$QK1)
wpct(ASFLe$QK1, weight=ASFLe$wght, na.rm=TRUE)
#e+u
selfassess_eu <- ASFLeu$QK1
hhsfknow_eu<- ifelse(ASFLeu$QK1 == "Very high", 1, 0)
hsfknow_eu<- ifelse(ASFLeu$QK1 == "Quite high", 1, 0)
highsfknow_eu <- hhsfknow_eu+hsfknow_eu
asfknow_eu<- ifelse(ASFLeu$QK1 == "About average", 1, 0)
lsfknow_eu<- ifelse(ASFLeu$QK1 == "Quite low", 1, 0)
llsfknow_eu<- ifelse(ASFLeu$QK1 == "Very low", 1, 0)
lowsfknow_eu <- lsfknow_eu+llsfknow_eu
summary(ASFLeu$QK1)
wpct(ASFLeu$QK1, weight=ASFLeu$wght, na.rm=TRUE)

#others
selfassess_oth <- ASFLoth$QK1
hhsfknow_oth<- ifelse(ASFLoth$QK1 == "Very high", 1, 0)
hsfknow_oth<- ifelse(ASFLoth$QK1 == "Quite high", 1, 0)
highsfknow_oth <- hhsfknow_oth+hsfknow_oth
asfknow_oth<- ifelse(ASFLoth$QK1 == "About average", 1, 0)
lsfknow_oth<- ifelse(ASFLoth$QK1 == "Quite low", 1, 0)
llsfknow_oth<- ifelse(ASFLoth$QK1 == "Very low", 1, 0)
lowsfknow_oth <- lsfknow_oth+llsfknow_oth
summary(ASFLoth$QK1)
wpct(ASFLoth$QK1, weight=ASFLoth$wght, na.rm=TRUE)

#others without retired
selfassess_othworet <- ASFLothworet$QK1
hhsfknow_othworet<- ifelse(ASFLothworet$QK1 == "Very high", 1, 0)
hsfknow_othworet<- ifelse(ASFLothworet$QK1 == "Quite high", 1, 0)
highsfknow_othworet <- hhsfknow_othworet+hsfknow_othworet
asfknow_othworet<- ifelse(ASFLothworet$QK1 == "About average", 1, 0)
lsfknow_othworet<- ifelse(ASFLothworet$QK1 == "Quite low", 1, 0)
llsfknow_othworet<- ifelse(ASFLothworet$QK1 == "Very low", 1, 0)
lowsfknow_othworet <- lsfknow_othworet+llsfknow_othworet
summary(ASFLothworet$QK1)
wpct(ASFLothworet$QK1, weight=ASFLothworet$wght, na.rm=TRUE)

#unemployed
table(ASFLunempl$QK1)
#retired
table(ASFLret$QK1)
#entrepreneurs
table(ASFLentrepreneurs$QK1)

table(ASFLse$QK1)/79
table(ASFLe$QK1)/699
table(ASFLret$QK1)/494
table(ASFLothworet$QK1)/146
table(ASFLunempl$QK1)/50
table(ASFLentrepreneurs$QK1)/19

#self-rated knowledge simple comparison plot
#unweighted
selfratedknow <- data.frame(status=rep(c('Self-employed', 'Employed','Others'), each=3),
                            selfassessment=rep(c('Low', 'Average', 'High'), times=3),
                            share=c(3/75,27/75,45/75,92/682,291/682,299/682, 143/625,255/625, 227/625))
selfratedknow$selfassessment<- factor(selfratedknow$selfassessment, levels=c('Low', 'Average', 'High'))
selfratedknow$status<- factor(selfratedknow$status, levels=c('Self-employed', 'Employed','Others'))
ggplot(selfratedknow, aes(fill=selfassessment, y=share, x=status)) + 
  geom_bar(position='stack', stat='identity')+
  labs(x="",y="Percentage share",fill="Self-assessed financial knowledge")
#weighted with others
selfratedknow <- data.frame(status=rep(c('Self-employed', 'Employed','Others'), each=4),
                            selfassessment=rep(c('Ref/Don´t know','Low', 'Average', 'High'), times=3),
                            share=c(0.04768587,0.04254538,0.34443552,0.5653332,0.02188622,0.1390004,0.4149923,0.4241211,0.02553137,0.2407209,0.3976323,0.3361154))
selfratedknow$selfassessment<- factor(selfratedknow$selfassessment, levels=c('Ref/Don´t know','Low', 'Average', 'High'))
selfratedknow$status<- factor(selfratedknow$status, levels=c('Self-employed', 'Employed','Others'))
ggplot(selfratedknow, aes(fill=selfassessment, y=share, x=status)) + 
  geom_bar(position='stack', stat='identity')+
  labs(x="",y="Percentage share",fill="Self-assessed financial knowledge")

#weighted
selfratedknow <- data.frame(status=rep(c('Self-employed', 'Employed'), each=4),
                            selfassessment=rep(c('Ref/Don´t know','Low', 'Average', 'High'), times=2),
                            share=c(0.04768587,0.04254538,0.34443552,0.5653332,0.02188622,0.1390004,0.4149923,0.4241211))
selfratedknow$selfassessment<- factor(selfratedknow$selfassessment, levels=c('Ref/Don´t know','Low', 'Average', 'High'))
selfratedknow$status<- factor(selfratedknow$status, levels=c('Self-employed', 'Employed'))
ggplot(selfratedknow, aes(fill=selfassessment, y=share, x=status)) + 
  geom_bar(position='stack', stat='identity')+
  labs(x="",y="Percentage share",fill="")

#self-rated knowledge specific comparison plot
#unweighted
selfratedknow_specific <- data.frame(status=rep(c('Self-employed', 'Employed','Others'), each=6),
                                     selfassessment=rep(c('Ref/Don´t know','Very low','Quite low', 'Average', 'Quite high', 'Very high'), times=3),
                                     share=c(4/79,2/79, 1/79, 27/79,34/79, 11/79,17/699,17/699,79/699,291/699,219/699,80/699,15/640,41/640,102/640,255/640,175/640,52/640))
selfratedknow_specific$selfassessment<- factor(selfratedknow_specific$selfassessment, levels=c('Ref/Don´t know','Very low','Quite low', 'Average', 'Quite high', 'Very high'))
selfratedknow_specific$status<- factor(selfratedknow_specific$status, levels=c('Self-employed', 'Employed','Others'))
ggplot(selfratedknow_specific, aes(fill=selfassessment, y=share, x=status)) + 
  geom_bar(position='stack', stat='identity')+
  labs(x="",y="Percentage share",fill="Self-assessed financial knowledge")
#weighted with others
selfratedknow_specific <- data.frame(status=rep(c('Self-employed', 'Employed','Others'), each=6),
                                     selfassessment=rep(c('Very high','Quite high', 'Average', 'Quite low', 'Very low','Ref/Don´t know'), times=3),
                                     share=c(0.11731588,0.44801736,0.34443552,0.01013686,0.03240852,0.04768587,0.109634073,0.314487009,0.414992278,0.115507818,0.023492600,0.02188622,0.07449853,0.26161683,0.39763232,0.16015121,0.08056974,0.02553137))
selfratedknow_specific$selfassessment<- factor(selfratedknow_specific$selfassessment, levels=c('Very high','Quite high', 'Average', 'Quite low', 'Very low','Ref/Don´t know'))
selfratedknow_specific$status<- factor(selfratedknow_specific$status, levels=c('Self-employed', 'Employed','Others'))
ggplot(selfratedknow_specific, aes(fill=selfassessment, y=share, x=status)) + 
  geom_bar(position='stack', stat='identity')+
  labs(x="",y="Percentage share",fill="Self-assessed financial knowledge")

#weighted
selfratedknow_specific <- data.frame(status=rep(c('Self-employed', 'Employed'), each=6),
                                     selfassessment=rep(c('Very high','Quite high', 'Average', 'Quite low', 'Very low','Ref/Don´t know'), times=2),
                                     share=c(0.11731588,0.44801736,0.34443552,0.01013686,0.03240852,0.04768587,0.109634073,0.314487009,0.414992278,0.115507818,0.023492600,0.02188622))
selfratedknow_specific$selfassessment<- factor(selfratedknow_specific$selfassessment, levels=c('Very high','Quite high', 'Average', 'Quite low', 'Very low','Ref/Don´t know'))
selfratedknow_specific$status<- factor(selfratedknow_specific$status, levels=c('Self-employed', 'Employed'))
ggplot(selfratedknow_specific, aes(fill=selfassessment, y=share, x=status)) + 
  geom_bar(position='stack', stat='identity')+
  labs(x="",y="Percentage share",fill="")

#self-rated knowledge specific gender comparison plot
#unweighted
selfratedknowgender <- data.frame(gender=rep(c('Male', 'Female'), each=6),
                                  selfassessment=rep(c('Don´t know','Very low','Quite low', 'Average', 'Quite high', 'Very high'), times=2),
                                  share=c(2/45,0/45,0/45,13/45,24/45,6/45,2/34,2/34,1/34,14/34,10/34,5/34))
selfratedknowgender$selfassessment<- factor(selfratedknowgender$selfassessment, levels=c('Don´t know','Very low','Quite low', 'Average', 'Quite high', 'Very high'))
selfratedknowgender$gender<- factor(selfratedknowgender$gender, levels=c('Male', 'Female'))
ggplot(selfratedknowgender, aes(fill=selfassessment, y=share, x=gender)) + 
  geom_bar(position='stack', stat='identity')+
  labs(x="",y="Percentage share",fill="Self-assessed financial knowledge")

#weighted
#self-employed
selfratedknowgender <- data.frame(gender=rep(c('Male', 'Female'), each=6),
                                  selfassessment=rep(c('Very high','Quite high', 'Average', 'Quite low', 'Very low','Ref/Don´t know'), times=2),
                                  share=c(0.12388988, 0.55073307, 0.29503202,0,0,0.03034502,  0.10765274, 0.29703540,0.41705377,0.02503704, 0.08004583,0.07317521 ))

selfratedknowgender$selfassessment<- factor(selfratedknowgender$selfassessment, levels=c('Very high','Quite high', 'Average', 'Quite low', 'Very low','Ref/Don´t know'))
selfratedknowgender$gender<- factor(selfratedknowgender$gender, levels=c('Male', 'Female'))
ggplot(selfratedknowgender, aes(fill=selfassessment, y=share, x=gender)) + 
  geom_bar(position='stack', stat='identity')+
  labs(x="",y="Percentage share",fill="")
#employed
selfratedknowgender <- data.frame(gender=rep(c('Male', 'Female'), each=6),
                                  selfassessment=rep(c('Very high','Quite high', 'Average', 'Quite low', 'Very low','Ref/Don´t know'), times=2),
                                  share=c(0.123241627 ,0.356358811 ,0.410727526,0.073273932, 0.012593160,0.02380494,0.095011378 , 0.269491520, 0.419575185,0.160892403, 0.035205152 , 0.01982436))

selfratedknowgender$selfassessment<- factor(selfratedknowgender$selfassessment, levels=c('Very high','Quite high', 'Average', 'Quite low', 'Very low','Ref/Don´t know'))
selfratedknowgender$gender<- factor(selfratedknowgender$gender, levels=c('Male', 'Female'))
ggplot(selfratedknowgender, aes(fill=selfassessment, y=share, x=gender)) + 
  geom_bar(position='stack', stat='identity')+
  labs(x="",y="Percentage share",fill="")
